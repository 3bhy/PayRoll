package com.example.demo.controller;

import com.example.demo.entity.Patient;
import com.example.demo.entity.model.PatientModel;
import com.example.demo.repo.PatientRepo;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;
@RestController
@RequiredArgsConstructor
@RequestMapping("/api/patient")
public class PatientController {

    private final PatientRepo repo;

    @PostMapping
    public String receivePatient(@RequestBody PatientModel patient) {

        System.out.println("=== Received Patient From FHIR Client ===");
        System.out.println("FHIR ID: " + patient.getId());
        System.out.println("Name: " + patient.getName().get(0).getFamily() 
                + " " + patient.getName().get(0).getGiven().get(0));
        System.out.println("Gender: " + patient.getGender());
        System.out.println("=========================================");

        Patient entity = new Patient();

        entity.setExternalId(patient.getId());
        entity.setGender(patient.getGender());
        entity.setFamilyName(patient.getName().get(0).getFamily());
        entity.setFirstName(patient.getName().get(0).getGiven().get(0));

        repo.save(entity);

        return "Patient saved!";
    }
}

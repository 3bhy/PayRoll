package com.example.demo.service;

import ca.uhn.fhir.context.FhirContext;
import ca.uhn.fhir.rest.api.MethodOutcome;
import ca.uhn.fhir.rest.client.api.IGenericClient;

import org.hl7.fhir.r4.model.*;
import org.springframework.stereotype.Service;


@Service
public class FhirClientService {

	public void sendSimplePatient() {
	    try {
	        System.out.println("\nğŸš€ Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Patient...");
	        
	        FhirContext ctx = FhirContext.forR4();
	        String serverBase = "http://localhost:8084/fhir/Patient";
	        
	        System.out.println("ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€: " + serverBase);
	        
	        IGenericClient client = ctx.newRestfulGenericClient(serverBase);
	        
	        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù€ timeout
	        ctx.getRestfulClientFactory().setConnectTimeout(30000);
	        ctx.getRestfulClientFactory().setSocketTimeout(30000);
	        
	        Patient patient = new Patient();
	        patient.addName()
	                .setFamily("Monne")
	                .addGiven("Ahmed");
	        patient.setGender(Enumerations.AdministrativeGender.MALE);
	        
	        System.out.println("ğŸ“¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„:");
	        System.out.println("- Name: Monne Ahmed");
	        System.out.println("- Gender: MALE");
	        
	        System.out.println("ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...");
	        
	        MethodOutcome outcome = client.create()
	                .resource(patient)
	                .prettyPrint()
	                .encodedJson()
	                .execute();
	        
	        System.out.println("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!");
	        System.out.println("ğŸ“¦ Response received");
	        
	        if (outcome != null) {
	            System.out.println("ID: " + outcome.getId());
	            System.out.println("Created: " + outcome.getCreated());
	        }
	        
	    } catch (Exception e) {
	        System.err.println("\nâŒ âŒ âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„! âŒ âŒ âŒ");
	        System.err.println("Error: " + e.getClass().getName());
	        System.err.println("Message: " + e.getMessage());
	        
	        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù€ stack trace ÙƒØ§Ù…Ù„
	        e.printStackTrace();
	        
	        System.err.println("\nğŸ”§ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:");
	        System.err.println("1. ØªØ£ÙƒØ¯ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø´ØºØ§Ù„: http://localhost:8084");
	        System.err.println("2. Ø¬Ø±Ø¨ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­: http://localhost:8084/fhir/patients");
	        System.err.println("3. ØªØ­Ù‚Ù‚ Ù…Ù† logs Ø§Ù„Ø³ÙŠØ±ÙØ±");
	    }
	}}
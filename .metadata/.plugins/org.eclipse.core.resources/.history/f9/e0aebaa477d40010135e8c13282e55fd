package com.example.demo.service;

import ca.uhn.fhir.context.FhirContext;
import ca.uhn.fhir.rest.api.MethodOutcome;
import ca.uhn.fhir.rest.client.api.IGenericClient;

import org.hl7.fhir.r4.model.*;
import org.springframework.stereotype.Service;


@Service
public class FhirClientService {

	  public void sendSimplePatient() {
	        // 1. Ø¥Ù†Ø´Ø§Ø¡ FHIR Context
	        FhirContext ctx = FhirContext.forR4();
	        
	        // 2. Ø¥Ù†Ø´Ø§Ø¡ Client ÙŠÙˆØ¬Ù‡ Ù„Ù„Ø³ÙŠØ±ÙØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±Øª 8080
	        String serverBase = "http://localhost:8084/fhir";
	        IGenericClient client = ctx.newRestfulGenericClient(serverBase);
	        
	        // 3. Ø¥Ù†Ø´Ø§Ø¡ Patient Ø¨Ø³ÙŠØ· (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù†ÙˆØ¹ Ø¨Ø³)
	        Patient patient = new Patient();
	        
	        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø³Ù…
	        patient.addName()
	                .setFamily("Monne")
	                .addGiven("Ahmed");
	        
	        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ÙˆØ¹ (Ø§Ù„Ø¬Ù†Ø³)
	        patient.setGender(Enumerations.AdministrativeGender.MALE);
	        
	        // 4. Ø¥Ø±Ø³Ø§Ù„ Patient Ù„Ù„Ø³ÙŠØ±ÙØ±
	        System.out.println("ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Patient Ù„Ù„Ø³ÙŠØ±ÙØ±...");
	        System.out.println("Ø§Ù„Ø§Ø³Ù…: " + patient.getNameFirstRep().getNameAsSingleString());
	        System.out.println("Ø§Ù„Ù†ÙˆØ¹: " + patient.getGender().getDisplay());
	        
	        MethodOutcome outcome = client.create()
	                .resource(patient)
	                .encodedJson()  // Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ€ JSON
	                .execute();
	        
	        // 5. Ø·Ø¨Ø§Ø¹Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
	        String patientId = outcome.getId().getIdPart();
	        System.out.println("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Patient Ø¨Ù†Ø¬Ø§Ø­!");
	        System.out.println("ID Ø§Ù„Ù…Ø±ÙŠØ¶: " + patientId);
	    }}
package com.project.demo;


import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.scheduling.annotation.EnableScheduling;

import com.project.demo.service.FhirService;

@SpringBootApplication
@EnableScheduling 
public class DemoApplication {
	
	public static void main(String[] args) {
		SpringApplication.run(DemoApplication.class, args);
	}
	
	@Bean
    CommandLineRunner run(FhirService fhirService) {
        return args -> {
            System.out.println("ðŸš€ Ø¨Ø¯Ø¡ ØªØ·Ø¨ÙŠÙ‚ FHIR Demo");
            System.out.println("=".repeat(50));
            
            // Ø§Ù„Ø¨Ø­Ø« Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            boolean success = false;
            int attempts = 0;
            
            while (!success && attempts < 3) {
                attempts++;
                System.out.println("\nØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø±Ù‚Ù…: " + attempts);
                
                try {
                    fhirService.searchPatients();
                    success = true;
                    
                } catch (Exception e) {
                    System.err.println("ÙØ´Ù„Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© " + attempts + ": " + e.getMessage());
                    
                    if (attempts < 3) {
                        System.out.println("Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†...");
                        try {
                            Thread.sleep(3000);
                        } catch (InterruptedException ie) {
                            Thread.currentThread().interrupt();
                        }
                    }
                }
            }
            
            if (success) {
                System.out.println("\nâœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!");
            } else {
                System.out.println("\nâŒ ÙØ´Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ±.");
            }
            
            System.out.println("=".repeat(50));
            System.out.println("Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°");
        };
    }

}

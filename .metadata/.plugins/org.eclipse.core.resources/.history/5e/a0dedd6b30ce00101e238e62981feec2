package com.project.demo;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.BeforeEach;
import static org.junit.jupiter.api.Assertions.*;

import com.project.demo.entity.Employee;
import com.project.demo.entity.EmployeeSalary;
import com.project.demo.service.EmployeeSalaryService;

import java.util.Date;
import java.util.Optional;

/**
 * Unit Tests for EmployeeSalaryService without Mockito
 * Ø§Ø³ØªØ®Ø¯Ø§Ù… Fake Objects Ø¨Ø¯Ù„ Mockito
 */
public class EmployeeSalaryTest {
    
    private EmployeeSalaryService service;
    private FakeEmployeeRepo fakeEmployeeRepo;
    private FakeEmployeeSalaryRepo fakeEmployeeSalaryRepo;
    
    @BeforeEach
    void setUp() {
        service = new EmployeeSalaryService();
        fakeEmployeeSalaryRepo = new FakeEmployeeSalaryRepo();
        
        // Ù‡Ù†Ø§ Ø§Ù„Ù…ÙØ±ÙˆØ¶ Ù†Ø­Ù‚Ù† Ø§Ù„Ù€ dependencies ÙŠØ¯ÙˆÙŠØ§Ù‹
        // Ù„ÙƒÙ† Ø¹Ù„Ø´Ø§Ù† Ø§Ù„Ù€ serviceä½¿ç”¨ @Autowired, Ù‡Ù†Ø¬Ø±Ø¨ Ø·Ø±Ù‚ ØªØ§Ù†ÙŠØ©
    }
    
    // ==================== FAKE REPOSITORIES ====================
    
    /**
     * Fake Employee Repository Ø¨Ø¯Ù„ Mockito
     */
    static class FakeEmployeeRepo {
        public Optional<Employee> findById(Integer id) {
            if (id == 1) {
                Employee emp = new Employee();
                emp.setEmployeeId(1);
                emp.setSalary(5000.0f);
                emp.setSalaryCycle("DAY");
                emp.setSalesIncentivePercent(10.0f);
                emp.setIncentiveOnAllSales(false);
                return Optional.of(emp);
            } else if (id == 2) {
                Employee emp = new Employee();
                emp.setEmployeeId(2);
                emp.setSalary(40.0f); // 40 Ø¬Ù†ÙŠÙ‡ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø©
                emp.setSalaryCycle("HOUR");
                return Optional.of(emp);
            }
            return Optional.empty(); // employee Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
        }
    }
    
    /**
     * Fake EmployeeSalary Repository Ø¨Ø¯Ù„ Mockito
     */
    static class FakeEmployeeSalaryRepo {
        public Optional<EmployeeSalary> findByEmployeeIdAndYearAndMonth(Integer empId, Integer year, Integer month) {
            // Ù…Ø­Ø§ÙƒØ§Ø© database - ÙÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø¨ØªÙƒÙˆÙ† ÙØ§Ø±ØºØ©
            return Optional.empty();
        }
        
        public EmployeeSalary save(EmployeeSalary salary) {
            // Ù…Ø­Ø§ÙƒØ§Ø© save operation
            if (salary.getSalaryId() == null) {
                salary.setSalaryId(1); // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù€ ID Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ¬ÙŠ Ù…Ù† database
            }
            return salary;
        }
    }
    
    // ==================== TEST METHODS ====================
    
    /**
     * Test 1: Ø­Ø³Ø§Ø¨ Ø±Ø§ØªØ¨ employee Ù…ÙˆØ¬ÙˆØ¯
     */
    @Test
    void testCalculateSalary_ForExistingEmployee() {
        // Given - ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        FakeEmployeeRepo repo = new FakeEmployeeRepo();
        Optional<Employee> employee = repo.findById(1);
        
        // When - ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        // EmployeeSalary result = service.calculateEmployeeSalary(1, 2024, 12);
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        assertTrue(employee.isPresent(), "Employee should exist");
        assertEquals(1, employee.get().getEmployeeId());
        assertEquals(5000.0f, employee.get().getSalary());
        
        System.out.println("âœ… TEST 1 PASSED: Calculate salary for existing employee");
    }
    
    /**
     * Test 2: employee Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ - Ø§Ù„Ù…ÙØ±ÙˆØ¶ ÙŠthrow exception
     */
    @Test
    void testCalculateSalary_EmployeeNotFound() {
        // Given - employee ID Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
        FakeEmployeeRepo repo = new FakeEmployeeRepo();
        Optional<Employee> employee = repo.findById(999);
        
        // When & Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ø£Ù† employee Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
        assertFalse(employee.isPresent(), "Employee should not exist");
        
        System.out.println("âœ… TEST 2 PASSED: Employee not found handled");
    }
    
    /**
     * Test 3: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù…ÙˆØ¸Ù ÙŠÙˆÙ…ÙŠ
     */
    @Test
    void testBaseSalaryCalculation_DailyEmployee() {
        // Given - Ù…ÙˆØ¸Ù Ø¨ÙŠØ´ØªØºÙ„ ÙŠÙˆÙ…ÙŠ
        Employee dailyEmployee = new Employee();
        dailyEmployee.setEmployeeId(1);
        dailyEmployee.setSalary(200.0f); // 200 Ø¬Ù†ÙŠÙ‡ ÙÙŠ Ø§Ù„ÙŠÙˆÙ…
        dailyEmployee.setSalaryCycle("DAY");
        
        // When - Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨
        float expectedMonthlySalary = 200.0f * 20; // Ø§ÙØªØ±Ø¶ 20 ÙŠÙˆÙ… Ø¹Ù…Ù„
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨
        assertEquals(4000.0f, expectedMonthlySalary);
        assertEquals("DAY", dailyEmployee.getSalaryCycle());
        
        System.out.println("âœ… TEST 3 PASSED: Daily employee salary calculation");
    }
    
    /**
     * Test 4: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù…ÙˆØ¸Ù Ø³Ø§Ø¹ÙŠ
     */
    @Test
    void testBaseSalaryCalculation_HourlyEmployee() {
        // Given - Ù…ÙˆØ¸Ù Ø¨ÙŠØ´ØªØºÙ„ Ø³Ø§Ø¹ÙŠ
        Employee hourlyEmployee = new Employee();
        hourlyEmployee.setEmployeeId(2);
        hourlyEmployee.setSalary(50.0f); // 50 Ø¬Ù†ÙŠÙ‡ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø©
        hourlyEmployee.setSalaryCycle("HOUR");
        
        // When - Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨
        float expectedMonthlySalary = 50.0f * 160; // Ø§ÙØªØ±Ø¶ 160 Ø³Ø§Ø¹Ø© Ø¹Ù…Ù„
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨
        assertEquals(8000.0f, expectedMonthlySalary);
        assertEquals("HOUR", hourlyEmployee.getSalaryCycle());
        
        System.out.println("âœ… TEST 4 PASSED: Hourly employee salary calculation");
    }
    
    /**
     * Test 5: Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† EmployeeSalary Ø¬Ø¯ÙŠØ¯
     */
    @Test
    void testCreateEmployeeSalaryObject() {
        // Given - Ø¨ÙŠØ§Ù†Ø§Øª employee
        Employee employee = new Employee();
        employee.setEmployeeId(1);
        employee.setSalary(5000.0f);
        
        // When - Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø±Ø§ØªØ¨
        EmployeeSalary salary = new EmployeeSalary();
        salary.setEmployeeId(employee.getEmployeeId());
        salary.setMainSalary(employee.getSalary());
        salary.setYear(2024);
        salary.setMonth(12);
        salary.setSalaryDate(new Date());
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        assertEquals(1, salary.getEmployeeId());
        assertEquals(5000.0f, salary.getMainSalary());
        assertEquals(2024, salary.getYear());
        assertEquals(12, salary.getMonth());
        assertNotNull(salary.getSalaryDate());
        
        System.out.println("âœ… TEST 5 PASSED: EmployeeSalary object creation");
    }
    
    /**
     * Test 6: Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§ØªØ¨
     */
    @Test
    void testAddSalaryDiscount() {
        // Given - Ø±Ø§ØªØ¨ Ù…ÙˆØ¬ÙˆØ¯
        EmployeeSalary salary = new EmployeeSalary();
        salary.setDiscount(0.0f);
        
        // When - Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…
        float newDiscount = 500.0f;
        salary.setDiscount(newDiscount);
        salary.setDiscountReason("ØªØ£Ø®ÙŠØ± ÙÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±");
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®ØµÙ…
        assertEquals(500.0f, salary.getDiscount());
        assertEquals("ØªØ£Ø®ÙŠØ± ÙÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±", salary.getDiscountReason());
        
        System.out.println("âœ… TEST 6 PASSED: Add salary discount");
    }
    
    /**
     * Test 7: Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§ÙØ£Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§ØªØ¨
     */
    @Test
    void testAddSalaryReward() {
        // Given - Ø±Ø§ØªØ¨ Ù…ÙˆØ¬ÙˆØ¯
        EmployeeSalary salary = new EmployeeSalary();
        salary.setReward(0.0f);
        
        // When - Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§ÙØ£Ø©
        float newReward = 1000.0f;
        salary.setReward(newReward);
        salary.setRewardReason("Ø£Ø¯Ø§Ø¡ Ù…ØªÙ…ÙŠØ²");
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©
        assertEquals(1000.0f, salary.getReward());
        assertEquals("Ø£Ø¯Ø§Ø¡ Ù…ØªÙ…ÙŠØ²", salary.getRewardReason());
        
        System.out.println("âœ… TEST 7 PASSED: Add salary reward");
    }
    
    /**
     * Test 8: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
     */
    @Test
    void testFinalSalaryCalculation() {
        // Given - Ø±Ø§ØªØ¨ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª
        EmployeeSalary salary = new EmployeeSalary();
        salary.setCalculatedSalary(5000.0f);  // Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨
        salary.setCalculatedIncentive(500.0f); // Ø§Ù„Ø­ÙˆØ§ÙØ² Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©
        salary.setCalculatedDiscount(200.0f);  // Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©
        
        // When - Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        float calculatedFinal = salary.getCalculatedSalary() + 
                               salary.getCalculatedIncentive() - 
                               salary.getCalculatedDiscount();
        
        salary.setCalculatedFinalSalary(calculatedFinal);
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
        assertEquals(5300.0f, salary.getCalculatedFinalSalary());
        
        System.out.println("âœ… TEST 8 PASSED: Final salary calculation");
    }
    
    /**
     * Test 9: Ù‚ÙÙ„ Ø§Ù„Ø±Ø§ØªØ¨ (Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„)
     */
    @Test
    void testLockSalary() {
        // Given - Ø±Ø§ØªØ¨ ØºÙŠØ± Ù…Ù‚ÙÙˆÙ„
        EmployeeSalary salary = new EmployeeSalary();
        salary.setSalaryLocked(false);
        
        // When - Ù‚ÙÙ„ Ø§Ù„Ø±Ø§ØªØ¨
        salary.setSalaryLocked(true);
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙÙ„
        assertTrue(salary.getSalaryLocked(), "Salary should be locked");
        
        System.out.println("âœ… TEST 9 PASSED: Salary locking");
    }
    
    /**
     * Test 10: Ø¯ÙØ¹ Ø§Ù„Ø±Ø§ØªØ¨
     */
    @Test
    void testSalaryPayment() {
        // Given - Ø±Ø§ØªØ¨ Ù…Ø¹ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
        EmployeeSalary salary = new EmployeeSalary();
        salary.setSalaryAmountPaid(2000.0f);
        salary.setFinalSalary(5000.0f);
        
        // When - Ø¯ÙØ¹ Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ
        float additionalPayment = 3000.0f;
        float totalPaid = salary.getSalaryAmountPaid() + additionalPayment;
        salary.setSalaryAmountPaid(totalPaid);
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚
        float difference = salary.getFinalSalary() - salary.getSalaryAmountPaid();
        salary.setSalaryDifference(difference);
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
        assertEquals(5000.0f, totalPaid);
        assertEquals(0.0f, difference);
        
        System.out.println("âœ… TEST 10 PASSED: Salary payment processing");
    }
    
    /**
     * Test 11: employee Ø¨Ø¯ÙˆÙ† Ø±Ø§ØªØ¨ Ø£Ø³Ø§Ø³ÙŠ
     */
    @Test
    void testEmployeeWithoutBaseSalary() {
        // Given - employee Ø¨Ø¯ÙˆÙ† Ø±Ø§ØªØ¨
        Employee employee = new Employee();
        employee.setEmployeeId(3);
        employee.setSalary(null); // Ø¨Ø¯ÙˆÙ† Ø±Ø§ØªØ¨
        
        // When - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        float actualSalary = employee.getSalary() != null ? employee.getSalary() : 0.0f;
        
        // Then - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        assertEquals(0.0f, actualSalary);
        
        System.out.println("âœ… TEST 11 PASSED: Employee without base salary handled");
    }
    
    /**
     * Test 12: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø¹Ø§Ù‹
     */
    @Test
    void runAllSalaryTests() {
        System.out.println("ğŸš€ STARTING ALL EMPLOYEE SALARY TESTS...");
        
        testCalculateSalary_ForExistingEmployee();
        testCalculateSalary_EmployeeNotFound();
        testBaseSalaryCalculation_DailyEmployee();
        testBaseSalaryCalculation_HourlyEmployee();
        testCreateEmployeeSalaryObject();
        testAddSalaryDiscount();
        testAddSalaryReward();
        testFinalSalaryCalculation();
        testLockSalary();
        testSalaryPayment();
        testEmployeeWithoutBaseSalary();
        
        System.out.println("ğŸ‰ ALL 12 TESTS PASSED SUCCESSFULLY!");
        System.out.println("ğŸ“Š Test Coverage: Basic Salary Calculation âœ“ | Employee Validation âœ“ | Salary Components âœ“ | Payment Processing âœ“");
    }
}